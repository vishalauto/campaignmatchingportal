<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Step Form</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        #multiStepForm {
            background: #fff;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }
        h2 {
            text-align: center;
            color: #333;
        }
        .form-step {
            display: none; /* Hide all steps by default */
        }
        .form-step.active {
            display: block; /* Show the active step */
        }
        .form-group {
            margin-bottom: 1.5em;
        }
        label {
            display: block;
            margin-bottom: 0.5em;
            font-weight: 600;
            color: #555;
        }
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Important for padding and width */
        }
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 2em;
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
        }
        .btn-next, .btn-submit {
            background-color: #007bff;
            color: white;
        }
        .btn-prev {
            background-color: #6c757d;
            color: white;
        }
        .error-message {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: 5px;
            display: none; /* Hidden by default */
        }
        .results-container {
            border-top: 1px solid #eee;
            margin-top: 1.5em;
            padding-top: 1.5em;
        }
        .results-container h5 {
            margin-top: 0;
            color: #007bff;
        }
        .transfer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 0.5em; /* Space between items */
            line-height: 1.4;
        }
        .transfer-item .number {
            font-weight: 600;
            font-family: monospace;
        }

        .stats-container {
            display: flex;
            justify-content: space-between;
            gap: 1em;
            margin-bottom: 2em;
            text-align: center;
        }
        .stat-box {
            background-color: #f8f9fa;
            padding: 1em;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            flex: 1;
        }
        .stat-box h4 {
            display: none; /* Hide the numbers */
        }
        .stat-box p {
            margin: 0;
            font-size: 0.85em; /* Slightly smaller to fit text */
            color: #333;
            font-weight: 500;
            line-height: 1.2;
        }
        .stats-container a {
            text-decoration: none; /* Remove underline from links */
            color: inherit; /* Make link text color same as parent */
            flex: 1; /* Ensure the link takes up the full space */
            display: flex; /* Make the link a flex container */
        }
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            font-size: 1em;
            color: #6c757d;
            font-weight: 500;
        }
        .footer a {
            color: #0056b3;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <form id="multiStepForm" action="/submit-data" method="post">
        <h2>Matching Campaigns</h2>

        <!-- Stats Boxes -->
        <div class="stats-container">
            <!-- These will be dynamically populated by JavaScript -->
            <!-- <div class="stat-box">
                <h4>4</h4>
                <p>Total Campaigns</p>
            </div>
            <div class="stat-box">
                <h4>34</h4>
                <p>Transfer Numbers</p>
            </div>
            <div class="stat-box">
                <h4>35</h4>
                <p>States Covered</p>
            </div> -->
        </div>

        <!-- Step 1: Age and State -->
        <div class="form-step active" id="step1">
            <div class="form-group">
                <label for="age">Age</label>
                <input type="number" id="age" name="age" placeholder="Enter your age" required>
                <div id="ageError" class="error-message"></div>
            </div>
            <div class="form-group">
                <label for="state">State</label>
                <select id="state" name="state" required>
                    <option value="" disabled selected>Select a state...</option>
                    <!-- States will be populated by JavaScript -->
                </select>
                <div id="stateError" class="error-message"></div>
            </div>
            <div class="button-group">
                <button type="button" class="btn-next" onclick="findCampaigns()">Find Available Campaigns</button>
            </div>
        </div>

        <!-- Step 2: Results -->
        <div class="form-step" id="step2">
            <div id="resultsList">
                <!-- Matching campaigns will be populated by JavaScript -->
            </div>
            <div class="button-group">
                <button type="button" class="btn-prev" onclick="prevStep()">Previous</button>
                <button type="button" class="btn-submit" onclick="resetForm()">Start Over</button>
            </div>
        </div>
    </form>

    <div class="footer">
        <p>Powered by <a href="http://www.leminsolutions.com" target="_blank">www.leminsolutions.com</a></p>
    </div>

    <script>
        const campaignData = {
            final_expense: {
                age: { min: 40, max: 80 },
                states: ["AL", "AR", "AZ", "CA", "CO", "FL", "GA", "IL", "IN", "KS", "KY", "LA", "MD", "MI", "MN", "MO", "NC", "NE", "NJ", "NM", "NV", "OH", "OR", "PA", "SC", "TN", "TX", "VA", "WA", "WI"],
                transfers: [],
                name: "FINAL EXPENSE"
            },
            ssdi: {
                age: { min: 35, max: 63 },
                states: ["AL", "AR", "AZ", "CA", "CO", "FL", "GA", "IL", "IN", "KS", "KY", "LA", "MD", "MI", "MN", "MO", "NY", "NC", "NE", "NJ", "NM", "NV", "OH", "OR", "PA", "SC", "TN", "TX", "VA", "WA", "WI"],
                transfers: [],
                name: "SSDI"
            },
            aca: {
                age: { min: 19, max: 64 },
                states: ["AL", "AR", "DE", "FL", "GA", "IL", "IN", "KS", "KY", "LA", "MI", "MN", "MO", "NH", "OH", "OK", "SC", "TN", "TX", "UT"],
                transfers: [],
                name: "ACA"
            }
        };

        // --- Function to update stats boxes dynamically ---
        function updateStats() {
            const statsContainer = document.querySelector('.stats-container');
            if (statsContainer) {
                statsContainer.innerHTML = `
                    <a href="ACA.html" target="_blank"><div class="stat-box"><p>ACA</p></div></a>
                    <a href="FE.html" target="_blank"><div class="stat-box"><p>FE</p></div></a>
                    <a href="SSDI.html" target="_blank"><div class="stat-box"><p>SSDI</p></div></a>
                `;
            }
        }

        // Call on page load
        updateStats();

        // --- Self-executing function to populate states on page load ---
        (function populateStates() {
            // Use a Set to automatically handle duplicates
            const allStates = new Set();
            for (const key in campaignData) {
                campaignData[key].states.forEach(state => allStates.add(state));
            }

            // Convert Set to array and sort it
            const sortedStates = Array.from(allStates).sort();

            const stateSelect = document.getElementById('state');
            sortedStates.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateSelect.appendChild(option);
            });
        })();

        const steps = Array.from(document.querySelectorAll('.form-step'));

        function goToStep(stepNumber) {
            steps.forEach((step, index) => {
                step.classList.toggle('active', index === stepNumber - 1);
            });
        }

        function findCampaigns() {
            if (!validateStep1()) {
                return;
            }

            const age = parseInt(document.getElementById('age').value, 10);
            const state = document.getElementById('state').value.toUpperCase();
            const resultsListDiv = document.getElementById('resultsList');
            resultsListDiv.innerHTML = ''; // Clear previous results

            let matchesFound = 0;

            for (const key in campaignData) {
                const campaign = campaignData[key];
                const isAgeMatch = age >= campaign.age.min && age <= campaign.age.max;
                const isStateMatch = campaign.states.includes(state);

                if (isAgeMatch && isStateMatch) {
                    matchesFound++;
                    const container = document.createElement('div');
                    container.className = 'results-container';

                    const title = document.createElement('h5');
                    title.textContent = campaign.name;
                    container.appendChild(title);

                    campaign.transfers.forEach(transfer => {
                        const p = document.createElement('p');
                        p.className = 'transfer-item';

                        // Split the string at the colon to separate name and number
                        const parts = transfer.split(':');
                        const name = parts[0].trim();
                        const number = parts.length > 1 ? parts[1].trim() : '';

                        // Create spans for layout
                        p.innerHTML = `<span>${name}</span> <span class="number">${number}</span>`;
                        container.appendChild(p);
                    });
                    resultsListDiv.appendChild(container);
                }
            }

            if (matchesFound === 0) {
                resultsListDiv.innerHTML = '<p>No matching campaigns found for the provided age and state.</p>';
            }

            goToStep(2);
        }

        function prevStep() {
            goToStep(1);
        }

        function resetForm() {
            // Clear input fields
            document.getElementById('age').value = '';
            document.getElementById('state').value = '';
            // Go back to the first step
            goToStep(1);
        }

        function validateStep1() {
            const ageInput = document.getElementById('age');
            const stateInput = document.getElementById('state');
            const ageError = document.getElementById('ageError');
            const stateError = document.getElementById('stateError');
            let isValid = true;

            // Reset errors
            ageError.style.display = 'none';
            stateError.style.display = 'none';

            // Validate Age
            const age = parseInt(ageInput.value, 10);
            if (isNaN(age) || age < 1) {
                ageError.textContent = `Please enter a valid age.`;
                ageError.style.display = 'block';
                isValid = false;
            }

            // Validate State
            if (!stateInput.value) {
                stateError.textContent = 'Please select a state.';
                stateError.style.display = 'block';
                isValid = false;
            }

            return isValid;
        }
    </script>

</body>
</html>